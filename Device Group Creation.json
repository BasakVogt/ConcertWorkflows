{"name":"Device Group Creation","platform":"node","hash":"BiG1qtgzgZ/aOfTw294MI08dVGUHI4D2ZN4SHDaO8QM=","blocks":[{"action":"system/SevOne/REST v3/Device Groups/Device Groups Filter Device Groups","name":"SevOne_Find_Parent_Group","inputs":[{"name":"authKey","value":"$NMSCredentials"},{"name":"body","value":"{\n    \"parentIds\": [2],\n    \"name\": $parentgroup\n}"}]}, {"action":"system/Common/Array/ArraySize","name":"ArraySize_Parent_Group","inputs":[{"name":"array","value":"$SevOne_Find_Parent_Group.result.content"}]}, {"action":"if","name":"If_Group_Found","then":[{"action":"assign","name":"Assign_Group_ID","variable":"$parentid","value":"$SevOne_Find_Parent_Group.result.content[0].id"}],"else":[{"action":"system/SevOne/REST v3/Device Groups/Device Groups Create Device Group","name":"SevOne_Create_Parent_Group","inputs":[{"name":"authKey","value":"$NMSCredentials"},{"name":"body","value":"{\n    \"name\": $parentgroup,\n    \"parentId\": 2\n}"}]},{"action":"assign","name":"Assign_Group_ID2","variable":"$parentid","value":"$SevOne_Create_Parent_Group.result.id"}],"condition":"$ArraySize_Parent_Group.result > 0"}, {"action":"system/SevOne/REST v3/Metadata/Metadata Devices (POST)","name":"SevOne_Devices","inputs":[{"name":"authKey","value":"$NMSCredentials"}]}, {"action":"foreach","name":"ForEach_Device","blocks":[{"action":"system/Common/String/StringRegExMatch","name":"Find_Structure","inputs":[{"name":"str","value":"$ForEach_Device.item.name"},{"name":"regex","value":"\"(^[A-Z]{3})-([A-Z])\""}]},{"action":"system/Common/Array/ArraySize","name":"ArraySize_Match","inputs":[{"name":"array","value":"$Find_Structure.result"}]},{"action":"if","name":"If_Structure_Found","then":[{"action":"assign","name":"First_3_Letters","variable":"$name","value":"$Find_Structure.result[0].match.slice(0, 3)"},{"action":"system/SevOne/REST v3/Device Groups/Device Groups Filter Device Groups","name":"SevOne_Find_Location_Group","inputs":[{"name":"authKey","value":"$NMSCredentials"},{"name":"body","value":"{\n    \"parentIds\": [ $parentid ],\n    \"name\": $name\n}"}]},{"action":"system/Common/Array/ArraySize","name":"ArraySize_Location_Group","inputs":[{"name":"array","value":"$SevOne_Find_Location_Group.result.content"}]},{"action":"if","name":"If_Group_Found2","then":[{"action":"assign","name":"Assign_Location_ID","variable":"$locationid","value":"$SevOne_Find_Location_Group.result.content[0].id"}],"else":[{"action":"system/SevOne/REST v3/Device Groups/Device Groups Create Device Group","name":"SevOne_Create_Location_Group","inputs":[{"name":"authKey","value":"$NMSCredentials"},{"name":"body","value":"{\n    \"name\": $name,\n    \"parentId\": $parentid\n}"}]},{"action":"assign","name":"Assign_Location_ID2","variable":"$parentid","value":"$SevOne_Create_Location_Group.result.id"},{"action":"system/SevOne/REST v3/Device Groups/Device Groups Create Device Group Rule","name":"SevOne_Add_Rule","inputs":[{"name":"authKey","value":"$NMSCredentials"},{"name":"body","value":"{\n    \"nameExpression\": $name,\n    \"groupId\": $locationid\n}"}]},{"action":"system/SevOne/REST v3/Device Groups/Device Groups Create Device Group Rule","name":"SevOne_Add_Rule_Parent","inputs":[{"name":"authKey","value":"$NMSCredentials"},{"name":"body","value":"{\n    \"nameExpression\": $name,\n    \"groupId\": $parentid\n}"}]}],"condition":"$ArraySize_Location_Group.result > 0"}],"else":[],"condition":"$ArraySize_Match.result > 0"},{"action":"system/SevOne/REST v3/Device Groups/Device Groups Device Group Rules Apply","name":"SevOne_Apply_Rules","inputs":[{"name":"authKey","value":"$NMSCredentials"}]}],"list":"$SevOne_Devices.result.devices"}],"variables":[{"name":"result","required":false,"isInput":false,"isOutput":true,"level":"INTERMEDIATE","type":{"type":"any"},"value":"\"\""},{"name":"NMSCredentials","required":false,"isInput":false,"isOutput":false,"level":"INTERMEDIATE","type":{"type":"string"},"value":"\"admin/SevOne\""},{"name":"parentgroup","required":true,"isInput":true,"isOutput":false,"level":"INTERMEDIATE","type":{"type":"string"},"value":"\"Locations\""}],"meta":{"version":5,"layout":"flow","workerGroup":"default","created":1710155825202,"lastUpdated":1710171426020,"numberOfBlocks":6}}